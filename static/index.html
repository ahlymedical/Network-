<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>الشبكة الطبية - الأهلي للخدمات الطبية</title>
<!-- Font Awesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
    :root {
        --primary-green: #006A4E;
        --primary-orange: #F58220;
        --special-green-teal: #008080;
        --accent-light-green: #E6F0ED;
        --white: #ffffff;
        --light-gray: #f0f2f5;
        --medium-gray: #e9ecef;
        --text-dark: #212529;
        --text-muted: #6c757d;
        --danger-red: #dc3545;
        --primary-glow: rgba(0, 106, 78, 0.25);
        --font-family-cairo: 'Cairo', sans-serif;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
        margin: 0;
        font-family: var(--font-family-cairo);
        background-color: var(--light-gray);
        color: var(--text-dark);
        line-height: 1.6;
        font-size: 16px;
    }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
    }
    .main-header {
        text-align: center;
        margin-bottom: 2.5rem;
    }
    .main-header .logo {
        max-width: 250px;
        margin-bottom: 1rem;
    }
    .main-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-green);
        margin: 0;
    }
    .card {
        background-color: var(--white);
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        padding: 2rem;
        margin-bottom: 2rem;
        transition: box-shadow 0.3s ease;
    }
    .card:hover { box-shadow: 0 8px 24px rgba(0,0,0,0.12); }
    .card h2 {
        font-size: 1.75rem;
        color: var(--special-green-teal);
        margin-top: 0;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--text-dark);
    }
    .form-control {
        width: 100%;
        padding: 0.8rem 1rem;
        border: 1px solid var(--medium-gray);
        border-radius: 8px;
        font-family: var(--font-family-cairo);
        font-size: 1rem;
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    .form-control:focus {
        outline: none;
        border-color: var(--primary-green);
        box-shadow: 0 0 0 3px var(--primary-glow);
    }
    .btn {
        padding: 0.8rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-family: var(--font-family-cairo);
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    .btn-primary {
        background-color: var(--primary-green);
        color: var(--white);
    }
    .btn-primary:hover { background-color: #00563f; }
    .btn:active { transform: translateY(1px); }
    .btn:disabled { background-color: #a0a0a0; cursor: not-allowed; }
    #search-results-container {
        margin-top: 2rem;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
    }
    .result-card {
        background: var(--white);
        border: 1px solid var(--medium-gray);
        border-radius: 10px;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .result-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    }
    .result-card h3 {
        font-size: 1.25rem;
        color: var(--primary-green);
        margin: 0 0 0.5rem 0;
    }
    .result-card p {
        margin: 0 0 0.75rem 0;
        color: var(--text-dark);
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    .result-card .specialty {
        font-weight: 600;
        color: var(--primary-orange);
    }
    .result-card .address { color: var(--text-muted); }
    .loader {
        text-align: center;
        padding: 2rem;
        font-size: 1.2rem;
        color: var(--text-muted);
    }
    .hidden { display: none; }
    .alert {
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
        border-radius: 8px;
        font-size: 1rem;
    }
    .alert-info {
        background-color: var(--accent-light-green);
        color: var(--primary-green);
        border: 1px solid var(--primary-green);
    }
</style>
</head>
<body>

<div class="container">
    <header class="main-header">
        <img src="https://www.alahlymedical.com/assets/images/logo.png" alt="شعار الأهلي للخدمات الطبية" class="logo">
        <h1>الشبكة الطبية</h1>
    </header>

    <!-- قسم البحث في الشبكة الطبية -->
    <section class="card" id="network-search">
        <h2><i class="fas fa-search"></i> البحث في الشبكة الطبية</h2>
        <div id="search-loader" class="loader">
            <p><i class="fas fa-spinner fa-spin"></i> جاري تحميل بيانات الشبكة...</p>
        </div>
        <form id="search-form" class="hidden">
            <div class="form-group">
                <label for="governorate-select">المحافظة</label>
                <select id="governorate-select" class="form-control">
                    <option value="">الكل</option>
                </select>
            </div>
            <div class="form-group">
                <label for="specialty-select">التخصص الرئيسي</label>
                <select id="specialty-select" class="form-control">
                    <option value="">الكل</option>
                </select>
            </div>
            <div class="form-group">
                <label for="provider-input">اسم مقدم الخدمة (اختياري)</label>
                <input type="text" id="provider-input" class="form-control" placeholder="اكتب جزء من الاسم للبحث...">
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> بحث</button>
        </form>
    </section>

    <!-- قسم عرض نتائج البحث -->
    <section id="search-results">
        <div id="results-summary" class="alert alert-info hidden"></div>
        <div id="search-results-container">
            <!-- سيتم إضافة النتائج هنا بواسطة الجافاسكريبت -->
        </div>
    </section>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- متغيرات عامة ---
    const searchForm = document.getElementById('search-form');
    const searchLoader = document.getElementById('search-loader');
    const governorateSelect = document.getElementById('governorate-select');
    const specialtySelect = document.getElementById('specialty-select');
    const providerInput = document.getElementById('provider-input');
    const resultsContainer = document.getElementById('search-results-container');
    const resultsSummary = document.getElementById('results-summary');

    let networkData = []; // لتخزين البيانات القادمة من الخادم

    // --- جلب البيانات من الخادم ---
    async function fetchData() {
        try {
            const response = await fetch('/api/network-data');
            if (!response.ok) {
                throw new Error('فشل تحميل بيانات الشبكة.');
            }
            networkData = await response.json();
            
            // بعد تحميل البيانات بنجاح
            populateFilters();
            searchLoader.classList.add('hidden');
            searchForm.classList.remove('hidden');
            displayResults(networkData); // عرض كل النتائج في البداية
            updateSummary(networkData.length);

        } catch (error) {
            console.error('Error fetching data:', error);
            searchLoader.innerHTML = `<p style="color: var(--danger-red);"><i class="fas fa-exclamation-triangle"></i> ${error.message}</p>`;
        }
    }

    // --- ملء قوائم الفلاتر (المحافظات والتخصصات) ---
    function populateFilters() {
        // استخراج قيم فريدة لكل من المحافظات والتخصصات
        const governorates = [...new Set(networkData.map(item => item['المحافظة']).filter(Boolean))];
        const specialties = [...new Set(networkData.map(item => item['التخصص الرئيسي']).filter(Boolean))];

        governorates.sort().forEach(gov => {
            const option = new Option(gov, gov);
            governorateSelect.add(option);
        });

        specialties.sort().forEach(spec => {
            const option = new Option(spec, spec);
            specialtySelect.add(option);
        });
    }

    // --- عرض نتائج البحث في الواجهة ---
    function displayResults(results) {
        resultsContainer.innerHTML = ''; // مسح النتائج القديمة
        if (results.length === 0) {
            return; // لا تفعل شيئًا إذا لم تكن هناك نتائج
        }

        results.forEach(item => {
            const card = document.createElement('div');
            card.className = 'result-card';
            
            const telephone = item['Telephone1'] || item['Telephone2'] || item['Hotline'] || 'غير متوفر';

            card.innerHTML = `
                <h3>${item['مقدم الخدمة'] || 'غير متوفر'}</h3>
                <p><i class="fas fa-stethoscope"></i> <span class="specialty">${item['التخصص الرئيسي'] || 'غير محدد'}</span></p>
                <p><i class="fas fa-map-marker-alt"></i> <span class="address">${item['عنوان مقدم الخدمة'] || 'غير متوفر'}</span></p>
                <p><i class="fas fa-phone"></i> ${telephone}</p>
            `;
            resultsContainer.appendChild(card);
        });
    }

    // --- تحديث ملخص عدد النتائج ---
    function updateSummary(count) {
        if (count > 0) {
            resultsSummary.textContent = `تم العثور على ${count} نتيجة.`;
            resultsSummary.classList.remove('hidden');
        } else {
             resultsSummary.textContent = 'لم يتم العثور على نتائج تطابق بحثك.';
             resultsSummary.classList.remove('hidden');
        }
    }

    // --- تنفيذ البحث عند إرسال النموذج ---
    searchForm.addEventListener('submit', function(event) {
        event.preventDefault();

        const selectedGov = governorateSelect.value;
        const selectedSpec = specialtySelect.value;
        const providerName = providerInput.value.trim();

        const filteredResults = networkData.filter(item => {
            const govMatch = !selectedGov || (item['المحافظة'] && item['المحافظة'] === selectedGov);
            const specMatch = !selectedSpec || (item['التخصص الرئيسي'] && item['التخصص الرئيسي'] === selectedSpec);
            const providerMatch = !providerName || (item['مقدم الخدمة'] && item['مقدم الخدمة'].includes(providerName));
            
            return govMatch && specMatch && providerMatch;
        });

        displayResults(filteredResults);
        updateSummary(filteredResults.length);
    });

    // --- بدء تحميل البيانات عند فتح الصفحة ---
    fetchData();
});
</script>

</body>
</html>
